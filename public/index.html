<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <title>–°–æ–∑–¥–∞—Ç—å –í–∞–ª–µ–Ω—Ç–∏–Ω–∫—É</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        @font-face {
            font-family: als_hauss_be;
            src: url("./als_hauss_be.otf")
        }

        @font-face {
            font-family: als_hauss;
            src: url("./hauss.ttf")
        }

        body {
            margin: 0;
            padding: 20px;
            background: #000;
            color: #fd4820;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            max-width: 500px;
            width: 100%;
            background: #000000;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        h1 {
            color: #fff;
            margin-bottom: 20px;
            font-family: als_hauss_be;
            font-size: 30px;
        }

        textarea {
            width: 480px;
            border: 0px solid;
            height: 100px;
            padding: 10px;
            font-size: 18px;
            font-family: als_hauss;
            margin: 10px 0;
            border-radius: 10px;
            background: #222;
            color: #fff;
            resize: none;
        }

        canvas {
            max-width: 100%;
            margin: 10px 0;
            border-radius: 10px;
        }

        button {
            width: 100%;
            padding: 20px;
            font-size: 22px;
            font-family: als_hauss_be;
            margin: 5px;
            background: #fd5300;
            color: #fff;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.2s;
        }

        .telegram {
            background-color: #0088cc;
            color: #fff;
        }

        button:hover {
            background: #fff;
            color: #000;
        }

        #buttons {
            display: none;
            margin-top: 15px;
        }

        .loading {
            display: none;
            color: #fd4820;
            margin-top: 10px;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>–ù–∏–∫–æ–ª–∞–π –ò—Ä–æ–Ω–æ–≤ —Å–æ–∑–¥–∞—Å—Ç –≤–∞–ª–µ–Ω—Ç–∏–Ω–∫—É —Å –ø–æ–∂–µ–ª–∞–Ω–∏—è–º–∏</h1>

        <textarea id="message" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–æ–∂–µ–ª–∞–Ω–∏–µ...">–° –î–Ω—ë–º –°–≤—è—Ç–æ–≥–æ –í–∞–ª–µ–Ω—Ç–∏–Ω–∞!
–õ—é–±–≤–∏ –∏ —Å—á–∞—Å—Ç—å—è!</textarea>

        <button onclick="generateValentine()">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å</button>

        <canvas id="valentineCanvas" width="500" height="500"></canvas>

        <div class="loading" id="loading">–ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä...</div>

        <div id="buttons">
            <button onclick="downloadValentine()">–°–∫–∞—á–∞—Ç—å</button>
            <button class="telegram" onclick="shareToTelegram()">–ü–æ–¥–µ–ª–∏—Ç—å—Å—è —á–µ—Ä–µ–∑ Telegram</button>
        </div>
    </div>
    <script>
        let lastHeartTime = 0;

        document.addEventListener('mousemove', e => {
            const now = Date.now();
            if (now - lastHeartTime < 100) return; // –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —á–∞—Å—Ç–æ—Ç—ã
            lastHeartTime = now;

            // —Å–æ–∑–¥–∞—ë–º img –≤–º–µ—Å—Ç–æ SVG path
            const heart = document.createElement('img');
            heart.src = 'heart.svg'; // –ø—É—Ç—å –∫ —Ç–≤–æ–µ–º—É —Ñ–∞–π–ª—É
            heart.style.width = (40 + Math.random() * 60) + 'px'; // 40-100px
            heart.style.height = 'auto';
            heart.style.position = 'fixed';
            heart.style.left = e.clientX + 'px';
            heart.style.top = e.clientY + 'px';
            heart.style.pointerEvents = 'none';
            heart.style.opacity = 0.8;
            heart.style.transform = `translate(-50%, -50%) rotate(${Math.random() * 360}deg)`;
            heart.style.transition = 'transform 1.5s ease-out, opacity 1.5s ease-out';

            document.body.appendChild(heart);

            // –∞–Ω–∏–º–∞—Ü–∏—è: –ø–æ–¥–Ω–∏–º–∞–µ–º –∏ —É–º–µ–Ω—å—à–∞–µ–º
            setTimeout(() => {
                const scale = 0.5 + Math.random() * 0.8;
                const yMove = -60 - Math.random() * 60;
                const xMove = -30 + Math.random() * 60;
                heart.style.transform = `translate(${xMove}px, ${yMove}px) scale(${scale}) rotate(${Math.random() * 360}deg)`;
                heart.style.opacity = 0;
            }, 10);

            setTimeout(() => heart.remove(), 1600);
        });
    </script>

    <script>

        let currentImageUrl = null;
        let currentImageId = null;
        function generateValentine() {
            const canvas = document.getElementById('valentineCanvas');
            const ctx = canvas.getContext('2d');
            const text = document.getElementById('message').value;

            ctx.clearRect(0, 0, 500, 500);

            // –§–æ–Ω –≥—Ä–∞–¥–∏–µ–Ω—Ç –Ω–µ–∂–Ω–æ-—Ä–æ–∑–æ–≤—ã–π
            const gradient = ctx.createLinearGradient(0, 0, 500, 500);
            gradient.addColorStop(0, '#ffe6f0');
            gradient.addColorStop(1, '#ffccd9');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, 500, 500);

            // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–µ—Ä–¥–µ—á–µ–∫ —Ä–∞–∑–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞, —Ü–≤–µ—Ç–∞ –∏ —Ñ–æ—Ä–º—ã
            const hearts = [
                { x: 250, y: 200, size: 50, color: '#ff99c8' },
                { x: 100, y: 100, size: 20, color: '#ffb3d1' },
                { x: 400, y: 100, size: 25, color: '#ff80aa' },
                { x: 100, y: 400, size: 15, color: '#ffc0d8' },
                { x: 400, y: 400, size: 30, color: '#ff99c8' },
                { x: 250, y: 50, size: 10, color: '#ffd6e8' }, // –º–∞–ª–µ–Ω—å–∫–∏–µ
                { x: 50, y: 250, size: 15, color: '#ffb3d1' },
                { x: 450, y: 250, size: 15, color: '#ff80aa' },
            ];

            hearts.forEach(h => {
                ctx.fillStyle = h.color;
                drawHeart(ctx, h.x, h.y, h.size);
            });

            // –¢–µ–∫—Å—Ç
            ctx.fillStyle = '#d6336c';
            ctx.font = 'bold 22px als_hauss';
            ctx.textAlign = 'center';
            ctx.globalAlpha = 1;

            const lines = text.split('\n');
            lines.forEach((line, i) => {
                ctx.fillText(line, 250, 300 + i * 30);
            });

            ctx.font = '14px als_hauss_be';
            ctx.fillText('–° –ª—é–±–æ–≤—å—é, ironov.ai', 250, 470);

            uploadToServer();
        }

        function drawHeart(ctx, x, y, size) {
            ctx.beginPath();
            ctx.moveTo(x, y);
            ctx.bezierCurveTo(x - size / 2, y - size, x - size, y - size / 3, x, y + size / 2);
            ctx.bezierCurveTo(x + size, y - size / 3, x + size / 2, y - size, x, y);
            ctx.fill();
        }

        async function uploadToServer() {
            const canvas = document.getElementById('valentineCanvas');
            const loading = document.getElementById('loading');
            const buttons = document.getElementById('buttons');

            loading.style.display = 'block';
            buttons.style.display = 'none';

            try {
                canvas.toBlob(async (blob) => {
                    const formData = new FormData();
                    formData.append('image', blob, 'valentine.png');

                    const response = await fetch('/api/upload', {
                        method: 'POST',
                        body: formData
                    });

                    const data = await response.json();

                    if (data.success) {
                        currentImageUrl = data.url;
                        currentImageId = data.id;
                        loading.style.display = 'none';
                        buttons.style.display = 'flex';
                        console.log('–ö–∞—Ä—Ç–∏–Ω–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞:', data.url);
                    } else {
                        loading.style.display = 'none';
                        console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', data.error);
                    }
                }, 'image/png');
            } catch (error) {
                loading.style.display = 'none';
                console.error('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏:', error);
            }
        }

        function downloadValentine() {
            const canvas = document.getElementById('valentineCanvas');
            const link = document.createElement('a');
            link.download = '–≤–∞–ª–µ–Ω—Ç–∏–Ω–∫–∞.png';
            link.href = canvas.toDataURL('image/png');
            link.click();
        }

        function shareToTelegram() {
            if (!currentImageUrl) return;
            const messageText = "–ù–∏–∫–æ–ª–∞–π –ò—Ä–æ–Ω–æ–≤ –ø–æ–∑–¥—Ä–∞–≤–ª—è–µ—Ç —Å –î–Ω–µ–º –í–∞–ª–µ–Ω—Ç–∏–Ω–∞ üíò";
            const telegramUrl = `https://t.me/share/url?url=${encodeURIComponent(currentImageUrl)}&text=${encodeURIComponent(messageText)}`;
            window.open(telegramUrl, '_blank');
        }

        window.onload = generateValentine;
    </script>
</body>

</html>